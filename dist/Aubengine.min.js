function Light(t){this.id=t,this.position=[0,0,0],this.ambient=[0,0,0,0],this.diffuse=[0,0,0,0],this.specular=[0,0,0,0]}function Mesh(t,e){this.filename=t,this.alias=e,this.ambient=null,this.diffuse=null,this.specular=null,this.wireframe=null,this.vertices=null,this.indices=null,this.scalars=null,this.textureCoords=null,this.texture=null,this.image=null,this.tbo=null,this.cbo=null,this.nbo=null,this.ibo=null,this.vbo=null,this.remote=null,this.Ni=1,this.Ka=[0,0,0],this.d=1,this.Kd=[.8,.80842,.64],this.illum=2,this.Ks=[.94944,.94944,.94944],this.Ns=96.07843,this.position=null,this.size=null,this.rotation=null}function Color(t){this.hex=t||"#FFFFFF",this.rgba=null,this.vec=null}function Camera(t,e,i,r,n,o){this.alias=t,this.matrix=mat4.create(),this.up=vec3.create(),this.right=vec3.create(),this.normal=vec3.create(),this.position=vec3.create(),this.focus=vec3.create(),this.azimuth=0,this.elevation=0,this.type=e,this.steps=0,this.home=vec3.create(),this.tHome=i,this.tFocus=r,this.tAzimuth=n,this.tElevation=o}function CameraInteractor(t,e){this.camera=t,this.canvas=e,this.update(),this.dragging=!1,this.picking=!1,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.button=0,this.ctrl=!1,this.key=0,this.MOTION_FACTOR=10,this.dloc=0,this.dstep=0,this.picker=null}function SceneTransforms(t){this.stack=[],this.camera=t,this.mvMatrix=mat4.create(),this.pMatrix=mat4.create(),this.nMatrix=mat4.create()}function NodeTree(t,e,i){this.entity=t||"",this.children=i||[],e?e.addChild(this):this.father=""}function Tree(){this.root=new NodeTree}function Aubengine(t){this.interactor=null,this.transforms=null,this.tree=new Tree,gl=Configuration.getGLContext(t),this.canvas=t}!function(t){t.glMatrixArrayType=t.MatrixArray=null,t.vec3={},t.mat3={},t.mat4={},t.quat4={},t.setMatrixArrayType=function(t){return glMatrixArrayType=MatrixArray=t},t.determineMatrixArrayType=function(){return setMatrixArrayType("undefined"!=typeof Float32Array?Float32Array:Array)},determineMatrixArrayType()}("undefined"!=typeof exports?global:this),vec3.create=function(t){var e=new MatrixArray(3);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):e[0]=e[1]=e[2]=0,e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.multiply=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],o=Math.sqrt(i*i+r*r+n*n);return o?1===o?(e[0]=i,e[1]=r,e[2]=n,e):(o=1/o,e[0]=i*o,e[1]=r*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)},vec3.cross=function(t,e,i){i||(i=t);var r=t[0],n=t[1],t=t[2],o=e[0],a=e[1],e=e[2];return i[0]=n*e-t*a,i[1]=t*o-r*e,i[2]=r*a-n*o,i},vec3.length=function(t){var e=t[0],i=t[1],t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var r=t[0]-e[0],n=t[1]-e[1],t=t[2]-e[2],e=Math.sqrt(r*r+n*n+t*t);return e?(e=1/e,i[0]=r*e,i[1]=n*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},vec3.lerp=function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},vec3.dist=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},vec3.unproject=function(t,e,i,r,n){n||(n=t);var o=mat4.create(),a=new MatrixArray(4);return a[0]=2*(t[0]-r[0])/r[2]-1,a[1]=2*(t[1]-r[1])/r[3]-1,a[2]=2*t[2]-1,a[3]=1,mat4.multiply(i,e,o),mat4.inverse(o)?(mat4.multiplyVec4(o,a),0===a[3]?null:(n[0]=a[0]/a[3],n[1]=a[1]/a[3],n[2]=a[2]/a[3],n)):null},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t||(t=mat3.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=n,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t||(t=mat4.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],o=t[6],a=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=o,t[11]=t[14],t[12]=n,t[13]=a,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],f=t[11],g=t[12],m=t[13],d=t[14],t=t[15];return g*c*s*n-u*m*s*n-g*a*h*n+o*m*h*n+u*a*d*n-o*c*d*n-g*c*r*l+u*m*r*l+g*i*h*l-e*m*h*l-u*i*d*l+e*c*d*l+g*a*r*f-o*m*r*f-g*i*s*f+e*m*s*f+o*i*d*f-e*a*d*f-u*a*r*t+o*c*r*t+u*i*s*t-e*c*s*t-o*i*h*t+e*a*h*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],g=t[11],m=t[12],d=t[13],p=t[14],v=t[15],y=i*s-r*a,A=i*l-n*a,b=i*u-o*a,x=r*l-n*s,M=r*u-o*s,R=n*u-o*l,T=c*d-h*m,E=c*p-f*m,L=c*v-g*m,C=h*p-f*d,F=h*v-g*d,N=f*v-g*p,P=y*N-A*F+b*C+x*L-M*E+R*T;return P?(P=1/P,e[0]=(s*N-l*F+u*C)*P,e[1]=(-r*N+n*F-o*C)*P,e[2]=(d*R-p*M+v*x)*P,e[3]=(-h*R+f*M-g*x)*P,e[4]=(-a*N+l*L-u*E)*P,e[5]=(i*N-n*L+o*E)*P,e[6]=(-m*R+p*b-v*A)*P,e[7]=(c*R-f*b+g*A)*P,e[8]=(a*F-s*L+u*T)*P,e[9]=(-i*F+r*L-o*T)*P,e[10]=(m*M-d*b+v*y)*P,e[11]=(-c*M+h*b-g*y)*P,e[12]=(-a*C+s*E-l*T)*P,e[13]=(i*C-r*E+n*T)*P,e[14]=(-m*x+d*A-p*y)*P,e[15]=(c*x-h*A+f*y)*P,e):null},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[4],a=t[5],s=t[6],l=t[8],u=t[9],c=t[10],h=c*a-s*u,f=-c*o+s*l,g=u*o-a*l,m=i*h+r*f+n*g;return m?(m=1/m,e||(e=mat3.create()),e[0]=h*m,e[1]=(-c*r+n*u)*m,e[2]=(s*r-n*a)*m,e[3]=f*m,e[4]=(c*i-n*l)*m,e[5]=(-s*i+n*o)*m,e[6]=g*m,e[7]=(-u*i+r*l)*m,e[8]=(a*i-r*o)*m,e):null},mat4.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],g=t[10],m=t[11],d=t[12],p=t[13],v=t[14],t=t[15],y=e[0],A=e[1],b=e[2],x=e[3],M=e[4],R=e[5],T=e[6],E=e[7],L=e[8],C=e[9],F=e[10],N=e[11],P=e[12],_=e[13],w=e[14],e=e[15];return i[0]=y*r+A*s+b*h+x*d,i[1]=y*n+A*l+b*f+x*p,i[2]=y*o+A*u+b*g+x*v,i[3]=y*a+A*c+b*m+x*t,i[4]=M*r+R*s+T*h+E*d,i[5]=M*n+R*l+T*f+E*p,i[6]=M*o+R*u+T*g+E*v,i[7]=M*a+R*c+T*m+E*t,i[8]=L*r+C*s+F*h+N*d,i[9]=L*n+C*l+F*f+N*p,i[10]=L*o+C*u+F*g+N*v,i[11]=L*a+C*c+F*m+N*t,i[12]=P*r+_*s+w*h+e*d,i[13]=P*n+_*l+w*f+e*p,i[14]=P*o+_*u+w*g+e*v,i[15]=P*a+_*c+w*m+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],e=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*e+t[12],i[1]=t[1]*r+t[5]*n+t[9]*e+t[13],i[2]=t[2]*r+t[6]*n+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2],e=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*e,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*e,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*e,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*e,i},mat4.translate=function(t,e,i){var r,n,o,a,s,l,u,c,h,f,g,m,d=e[0],p=e[1],e=e[2];return i&&t!==i?(r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],g=t[10],m=t[11],i[0]=r,i[1]=n,i[2]=o,i[3]=a,i[4]=s,i[5]=l,i[6]=u,i[7]=c,i[8]=h,i[9]=f,i[10]=g,i[11]=m,i[12]=r*d+s*p+h*e+t[12],i[13]=n*d+l*p+f*e+t[13],i[14]=o*d+u*p+g*e+t[14],i[15]=a*d+c*p+m*e+t[15],i):(t[12]=t[0]*d+t[4]*p+t[8]*e+t[12],t[13]=t[1]*d+t[5]*p+t[9]*e+t[13],t[14]=t[2]*d+t[6]*p+t[10]*e+t[14],t[15]=t[3]*d+t[7]*p+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var r=e[0],n=e[1],e=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,r){var n,o,a,s,l,u,c,h,f,g,m,d,p,v,y,A,b,x,M,R,T=i[0],E=i[1],i=i[2],L=Math.sqrt(T*T+E*E+i*i);return L?(1!==L&&(L=1/L,T*=L,E*=L,i*=L),n=Math.sin(e),o=Math.cos(e),a=1-o,e=t[0],L=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],f=t[7],g=t[8],m=t[9],d=t[10],p=t[11],v=T*T*a+o,y=E*T*a+i*n,A=i*T*a-E*n,b=T*E*a-i*n,x=E*E*a+o,M=i*E*a+T*n,R=T*i*a+E*n,T=E*i*a-T*n,E=i*i*a+o,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*v+u*y+g*A,r[1]=L*v+c*y+m*A,r[2]=s*v+h*y+d*A,r[3]=l*v+f*y+p*A,r[4]=e*b+u*x+g*M,r[5]=L*b+c*x+m*M,r[6]=s*b+h*x+d*M,r[7]=l*b+f*x+p*M,r[8]=e*R+u*T+g*E,r[9]=L*R+c*T+m*E,r[10]=s*R+h*T+d*E,r[11]=l*R+f*T+p*E,r):null},mat4.rotateX=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[4],o=t[5],a=t[6],s=t[7],l=t[8],u=t[9],c=t[10],h=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=n*e+l*r,i[5]=o*e+u*r,i[6]=a*e+c*r,i[7]=s*e+h*r,i[8]=n*-r+l*e,i[9]=o*-r+u*e,i[10]=a*-r+c*e,i[11]=s*-r+h*e,i},mat4.rotateY=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[0],o=t[1],a=t[2],s=t[3],l=t[8],u=t[9],c=t[10],h=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+l*-r,i[1]=o*e+u*-r,i[2]=a*e+c*-r,i[3]=s*e+h*-r,i[8]=n*r+l*e,i[9]=o*r+u*e,i[10]=a*r+c*e,i[11]=s*r+h*e,i},mat4.rotateZ=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),n=t[0],o=t[1],a=t[2],s=t[3],l=t[4],u=t[5],c=t[6],h=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+l*r,i[1]=o*e+u*r,i[2]=a*e+c*r,i[3]=s*e+h*r,i[4]=n*-r+l*e,i[5]=o*-r+u*e,i[6]=a*-r+c*e,i[7]=s*-r+h*e,i},mat4.frustum=function(t,e,i,r,n,o,a){a||(a=mat4.create());var s=e-t,l=r-i,u=o-n;return a[0]=2*n/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*n/l,a[6]=0,a[7]=0,a[8]=(e+t)/s,a[9]=(r+i)/l,a[10]=-(o+n)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(2*o*n)/u,a[15]=0,a},mat4.perspective=function(t,e,i,r,n){return t=i*Math.tan(t*Math.PI/360),e*=t,mat4.frustum(-e,e,-t,t,i,r,n)},mat4.ortho=function(t,e,i,r,n,o,a){a||(a=mat4.create());var s=e-t,l=r-i,u=o-n;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/u,a[11]=0,a[12]=-(t+e)/s,a[13]=-(r+i)/l,a[14]=-(o+n)/u,a[15]=1,a},mat4.lookAt=function(t,e,i,r){r||(r=mat4.create());var n,o,a,s,l,u,c,h,f=t[0],g=t[1],t=t[2];return a=i[0],s=i[1],o=i[2],c=e[0],i=e[1],n=e[2],f===c&&g===i&&t===n?mat4.identity(r):(e=f-c,i=g-i,c=t-n,h=1/Math.sqrt(e*e+i*i+c*c),e*=h,i*=h,c*=h,n=s*c-o*i,o=o*e-a*c,a=a*i-s*e,(h=Math.sqrt(n*n+o*o+a*a))?(h=1/h,n*=h,o*=h,a*=h):a=o=n=0,s=i*a-c*o,l=c*n-e*a,u=e*o-i*n,(h=Math.sqrt(s*s+l*l+u*u))?(h=1/h,s*=h,l*=h,u*=h):u=l=s=0,r[0]=n,r[1]=s,r[2]=e,r[3]=0,r[4]=o,r[5]=l,r[6]=i,r[7]=0,r[8]=a,r[9]=u,r[10]=c,r[11]=0,r[12]=-(n*f+o*g+a*t),r[13]=-(s*f+l*g+u*t),r[14]=-(e*f+i*g+c*t),r[15]=1,r)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var r=t[0],n=t[1],o=t[2],a=t[3],s=r+r,l=n+n,u=o+o,t=r*s,c=r*l,r=r*u,h=n*l,n=n*u,o=o*u,s=a*s,l=a*l,a=a*u;return i[0]=1-(h+o),i[1]=c+a,i[2]=r-l,i[3]=0,i[4]=c-a,i[5]=1-(t+o),i[6]=n+s,i[7]=0,i[8]=r+l,i[9]=n-s,i[10]=1-(t+h),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],r=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t)},quat4.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},quat4.inverse=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],i=(i=i*i+r*r+n*n+o*o)?1/i:0;return e&&t!==e?(e[0]=-t[0]*i,e[1]=-t[1]*i,e[2]=-t[2]*i,e[3]=t[3]*i,e):(t[0]*=-i,t[1]*=-i,t[2]*=-i,t[3]*=i,t)},quat4.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],r=t[2],t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],o=t[3],a=Math.sqrt(i*i+r*r+n*n+o*o);return 0===a?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(a=1/a,e[0]=i*a,e[1]=r*a,e[2]=n*a,e[3]=o*a,e)},quat4.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],o=t[2],t=t[3],a=e[0],s=e[1],l=e[2],e=e[3];return i[0]=r*e+t*a+n*l-o*s,i[1]=n*e+t*s+o*a-r*l,i[2]=o*e+t*l+r*s-n*a,i[3]=t*e-r*a-n*s-o*l,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],o=e[2],e=t[0],a=t[1],s=t[2],t=t[3],l=t*r+a*o-s*n,u=t*n+s*r-e*o,c=t*o+e*n-a*r,r=-e*r-a*n-s*o;return i[0]=l*t+r*-e+u*-s-c*-a,i[1]=u*t+r*-a+c*-e-l*-s,i[2]=c*t+r*-s+l*-a-u*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],r=t[1],n=t[2],o=t[3],a=i+i,s=r+r,l=n+n,u=i*a,c=i*s,i=i*l,h=r*s,r=r*l,n=n*l,a=o*a,s=o*s,o=o*l;return e[0]=1-(h+n),e[1]=c+o,e[2]=i-s,e[3]=c-o,e[4]=1-(u+n),e[5]=r+a,e[6]=i+s,e[7]=r-a,e[8]=1-(u+h),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],r=t[1],n=t[2],o=t[3],a=i+i,s=r+r,l=n+n,u=i*a,c=i*s,i=i*l,h=r*s,r=r*l,n=n*l,a=o*a,s=o*s,o=o*l;return e[0]=1-(h+n),e[1]=c+o,e[2]=i-s,e[3]=0,e[4]=c-o,e[5]=1-(u+n),e[6]=r+a,e[7]=0,e[8]=i+s,e[9]=r-a,e[10]=1-(u+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,r){r||(r=t);var n,o,a=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(a)?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(n=Math.acos(a),o=Math.sqrt(1-a*a),.001>Math.abs(o)?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(a=Math.sin((1-i)*n)/o,i=Math.sin(i*n)/o,r[0]=t[0]*a+e[0]*i,r[1]=t[1]*a+e[1]*i,r[2]=t[2]*a+e[2]*i,r[3]=t[3]*a+e[3]*i,r))},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var gl=null,prg=null,c_width=0,c_height=0,names=["webgl","experimental-webgl","webkit-3d","moz-webgl"],interactor=null,Configuration={getGLContext:function(t){var e=document.getElementById(t),i=null;if(null==e)return alert("Hey! There is no canvas!"),null;c_width=e.width,c_height=e.height;for(var r=0;r<names.length;++r){try{i=e.getContext(names[r])}catch(n){}if(i)break}return null==i?(alert("Sorry! Not posible to initialize :("),null):i},requestAnimFrame:function(t){requestAnimFrame(t)},calculateNormals:function(t,e){for(var i=0,r=1,n=2,o=[],a=0;a<t.length;a+=3)o[a+i]=0,o[a+r]=0,o[a+n]=0;for(var a=0;a<e.length;a+=3){var s=[],l=[],u=[];for(s[i]=t[3*e[a+2]+i]-t[3*e[a+1]+i],s[r]=t[3*e[a+2]+r]-t[3*e[a+1]+r],s[n]=t[3*e[a+2]+n]-t[3*e[a+1]+n],l[i]=t[3*e[a]+i]-t[3*e[a+1]+i],l[r]=t[3*e[a]+r]-t[3*e[a+1]+r],l[n]=t[3*e[a]+n]-t[3*e[a+1]+n],u[i]=s[r]*l[n]-s[n]*l[r],u[r]=s[n]*l[i]-s[i]*l[n],u[n]=s[i]*l[r]-s[r]*l[i],j=0;j<3;j++)o[3*e[a+j]+i]=o[3*e[a+j]+i]+u[i],o[3*e[a+j]+r]=o[3*e[a+j]+r]+u[r],o[3*e[a+j]+n]=o[3*e[a+j]+n]+u[n]}for(var a=0;a<t.length;a+=3){var c=[];c[i]=o[a+i],c[r]=o[a+r],c[n]=o[a+n];var h=Math.sqrt(c[i]*c[i]+c[r]*c[r]+c[n]*c[n]);0==h&&(h=1),c[i]=c[i]/h,c[r]=c[r]/h,c[n]=c[n]/h,o[a+i]=c[i],o[a+r]=c[r],o[a+n]=c[n]}return o},calculateTangents:function(t,e,i){var r,n=[];for(r=0;r<t.length/3;r++)n[r]=[0,0,0];var o=[0,0,0],a=[0,0,0],s=[0,0,0];for(r=0;r<i.length;r+=3){var l=i[r+0],u=i[r+1],c=i[r+2],h=[t[3*l],t[3*l+1],t[3*l+2]],f=[t[3*u],t[3*u+1],t[3*u+2]],g=[t[3*c],t[3*c+1],t[3*c+2]],m=[e[2*l],e[2*l+1]],d=[e[2*u],e[2*u+1]],p=[e[2*c],e[2*c+1]];vec3.subtract(f,h,o),vec3.subtract(g,h,a);var v=(d[0]-m[0],d[1]-m[1]),y=(p[0]-m[0],p[0]-m[1]);s=[y*o[0]-v*a[0],y*o[1]-v*a[1],y*o[2]-v*a[2]],vec3.add(n[l],s),vec3.add(n[u],s),vec3.add(n[c],s)}var A=[];for(r=0;r<n.length;r++){var b=n[r];vec3.normalize(b),A.push(b[0]),A.push(b[1]),A.push(b[2])}return A}};requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Light.prototype.setPosition=function(t){this.position=t.slice(0)},Light.prototype.setDiffuse=function(t){this.diffuse=t.slice(0)},Light.prototype.setAmbient=function(t){this.ambient=t.slice(0)},Light.prototype.setSpecular=function(t){this.specular=t.slice(0)},Light.prototype.setProperty=function(t,e){if("string"!=typeof t)throw"The property name must be a string";this[t]=e instanceof Array?e.slice(0):e};var Lights={list:[],add:function(t){return t instanceof Light?void this.list.push(t):void alert("the parameter is not a light")},getArray:function(t){for(var e=[],i=0,r=this.list.length;r>i;i+=1)e=e.concat(this.list[i][t]);return e},get:function(t){if("number"==typeof t&&t>=0&&t<this.list.length)return this.list[t];if("string"==typeof t){for(var e=0,i=this.list.length;i>e;e+=1)if(this.list[e].id==t)return this.list[e];throw"Light "+t+" does not exist"}throw"Unknown parameter"},setNumLights:function(){return this.list.length<=0?4:this.list.length}},Shaders={vertex:{type:"x-shader/x-vertex",content:"const int NUM_LIGHTS ="+Lights.setNumLights()+";\n   attribute vec3 aVertexPosition;\n   attribute vec3 aVertexNormal;\n   attribute vec4 aVertexColor;\n   uniform mat4 uMVMatrix;\n   uniform mat4 uPMatrix;\n   uniform mat4 uNMatrix;\n   uniform bool uTranslateLights;\n   uniform vec3 uLightPosition[NUM_LIGHTS];\n   varying vec3 vNormal;\n   varying vec3 vLightRay[NUM_LIGHTS];\n   varying vec3 vEye[NUM_LIGHTS];\n   void main(void) {\n        vec4 c = aVertexColor;\n        vec4 vertex = uMVMatrix * vec4(aVertexPosition, 1.0);\n        vNormal = vec3(uNMatrix * vec4(aVertexNormal, 1.0));\n        vec4 lightPosition = vec4(0.0);\n        if (uTranslateLights){             for(int i=0; i < NUM_LIGHTS; i++){               lightPosition =   uMVMatrix * vec4(uLightPosition[i], 1.0);\n              vLightRay[i] = vertex.xyz - lightPosition.xyz;\n              vEye[i] = -vec3(vertex.xyz);\n            }\n        }\n        else {\n           for(int i=0; i < NUM_LIGHTS; i++){\n             lightPosition = vec4(uLightPosition[i], 1.0);\n             vLightRay[i] = vertex.xyz - lightPosition.xyz;\n             vEye[i] = -vec3(vertex.xyz);\n           }\n       }\n       gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n   }\n"},fragment:{type:"x-shader/x-fragment",content:"#ifdef GL_ES\nprecision highp float;\n#endif\n  const int NUM_LIGHTS ="+Lights.setNumLights()+";\n  uniform vec3  uLa[NUM_LIGHTS];\n  uniform vec3  uLd[NUM_LIGHTS];\n  uniform vec3  uLs[NUM_LIGHTS];\n  uniform vec3  uLightPosition[NUM_LIGHTS];\n  uniform vec3  uKa;\n  uniform vec3  uKd;\n  uniform vec3  uKs;\n  uniform float uNs;\n  uniform float d;\n  uniform int   illum;\n  uniform bool  uWireframe;\n  varying vec3 vNormal;\n  varying vec3 vLightRay[NUM_LIGHTS];\n  varying vec3 vEye[NUM_LIGHTS];\n  float calculateAttenuation(in vec3 ray){\n      float dist = length(ray);\n      return (1.0 / (0.1 * dist));\n  }\n  void main(void) {\n      if (uWireframe || illum == 0){\n          gl_FragColor = vec4(uKd,d);\n          return;\n      }\n     vec3 COLOR = vec3(0.0,0.0,0.0);\n     vec3 N =  normalize(vNormal);\n     vec3 L =  vec3(0.0,0.0,0.0);\n     vec3 E =  vec3(0.0,0.0,0.0);\n     vec3 R =  vec3(0.0,0.0,0.0);\n     vec3 deltaRay = vec3(0.0);\n     const int  lsize = 2;\n     const float step = 0.25;\n     const float inv_total = 1.0/((float(lsize*lsize) + 1.0)*(float(lsize*lsize) + 1.0));\n     float dx = 0.0;\n     float dz = 0.0;\n     float LT = 0.0;\n     if (illum == 1){\n          for(int i = 0; i < NUM_LIGHTS; i++){\n              L = normalize(vLightRay[i]);\n              N = normalize(vNormal);\n              COLOR += (uLa[i] * uKa) + (uLd[i] * uKd * clamp(dot(N, -L),0.0,1.0));\n          }\n          gl_FragColor =  vec4(COLOR,d);\n          return;\n     }\n     if (illum == 2){\n          for(int i = 0; i < NUM_LIGHTS; i++){\n              E = normalize(vEye[i]);\n              L = normalize(vLightRay[i]);\n              R = reflect(L, N);\n              COLOR += (uLa[i] * uKa);\n              COLOR += (uLd[i] * uKd * clamp(dot(N,-L),0.0,1.0));\n              COLOR += (uLs[i] * uKs * pow( max(dot(R, E), 0.0), uNs) * 4.0);\n          }\n          gl_FragColor =  vec4(COLOR,d);\n          return;\n     }\n  }\n"}},Program={attributeList:["aVertexPosition","aVertexNormal","aVertexColor"],uniformList:["uPMatrix","uMVMatrix","uNMatrix","uLightPosition","uWireframe","uLa","uLd","uLs","uKa","uKd","uKs","uNs","d","illum","uTranslateLights"],getShader:function(t,e){var i,r,n=Shaders[e].content,o=Shaders[e].type;if("x-shader/x-fragment"==o)i=t.createShader(t.FRAGMENT_SHADER),r="Fragment Shader";else{if("x-shader/x-vertex"!=o)return null;i=t.createShader(t.VERTEX_SHADER),r="Vertex Shader"}return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert("There was a problem with the "+r+":\n\n"+t.getShaderInfoLog(i)),null)},load:function(){var t=Program.getShader(gl,"fragment"),e=Program.getShader(gl,"vertex");prg=gl.createProgram(),gl.attachShader(prg,e),gl.attachShader(prg,t),gl.bindAttribLocation(prg,0,"aVertexPosition"),gl.linkProgram(prg),gl.getProgramParameter(prg,gl.LINK_STATUS)||alert("Could not initialise shaders"),gl.useProgram(prg),gl.enableVertexAttribArray(0),this.setAttributeLocations(this.attributeList),this.setUniformLocations(this.uniformList)},setAttributeLocations:function(t){for(var e=0,i=t.length;i>e;e+=1)this[t[e]]=gl.getAttribLocation(prg,t[e])},setUniformLocations:function(t){for(var e=0,i=t.length;i>e;e+=1)this[t[e]]=gl.getUniformLocation(prg,t[e])},getUniform:function(t){return gl.getUniform(prg,t)}};Mesh.prototype.getAlias=function(){return this.alias},Mesh.prototype.getFilename=function(){return this.filename},Mesh.prototype.getPosition=function(){return this.position},Mesh.prototype.setPosition=function(t){this.position=t},Mesh.prototype.getRotation=function(){return this.rotation},Mesh.prototype.setRotation=function(t){this.rotation=t},Mesh.prototype.setSize=function(t){this.size=t},Mesh.prototype.getSize=function(){return this.size},Mesh.prototype.getAttributes=function(){var t={Ni:this.Ni,Ka:this.Ka,d:this.d,Kd:this.Kd,illum:this.illum,Ks:this.Ks,Ns:this.Ns};return t},Mesh.prototype.draw=function(t){try{console.log(t);var e=Scene.getObject(this.getAlias());if(t.calculateModelView(),t.push(),null!=this.getPosition()){var i=t.mvMatrix;mat4.translate(i,this.getPosition())}if(null!=this.getSize()){var i=t.mvMatrix;mat4.scale(i,this.getSize())}null!=this.getRotation(),t.setMatrixUniforms(),t.pop(),gl.enableVertexAttribArray(Program.aVertexPosition),gl.disableVertexAttribArray(Program.aVertexNormal),gl.disableVertexAttribArray(Program.aVertexColor),gl.uniform1i(Program.uWireframe,!1),gl.uniform3fv(Program.uKa,e.Ka),gl.uniform3fv(Program.uKd,e.Kd),gl.uniform3fv(Program.uKs,e.Ks),gl.uniform1f(Program.uNs,e.Ns),gl.uniform1f(Program.d,e.d),gl.uniform1i(Program.illum,e.illum),e.d<1&&gl.uniform1f(Program.d,.14),gl.bindBuffer(gl.ARRAY_BUFFER,e.vbo),gl.vertexAttribPointer(Program.aVertexPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(Program.aVertexPosition),e.wireframe?gl.uniform1i(Program.uWireframe,!0):(gl.bindBuffer(gl.ARRAY_BUFFER,e.nbo),gl.vertexAttribPointer(Program.aVertexNormal,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(Program.aVertexNormal)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,e.ibo),e.wireframe?gl.drawElements(gl.LINES,e.indices.length,gl.UNSIGNED_SHORT,0):gl.drawElements(gl.TRIANGLES,e.indices.length,gl.UNSIGNED_SHORT,0),gl.bindBuffer(gl.ARRAY_BUFFER,null),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)}catch(r){alert(r),console.error(r.description)}};var Scene={objects:[],getObject:function(t){for(var e=0,i=Scene.objects.length;i>e;e++)if(t==Scene.objects[e].alias)return Scene.objects[e];return null},loadObject:function(t,e,i,r){var n=new XMLHttpRequest;console.info("Requesting "+t),n.open("GET",t),n.onreadystatechange=function(){if(4==n.readyState)if(404==n.status)console.info(t+" does not exist");else{var o=JSON.parse(n.responseText);o.alias=null==e?"none":e,o.remote=!0,Scene.addObject(o,i,r)}},n.send()},loadObjectByParts:function(t,e,i){for(var r=1;i>=r;r++){var n=t+""+r+".json",o=e+""+r;Scene.loadObject(n,o)}},addObject:function(t,e,i){void 0===t.wireframe&&(t.wireframe=!1),void 0===t.diffuse&&(t.diffuse=[1,1,1,1]),void 0===t.ambient&&(t.ambient=[.2,.2,.2,1]),void 0===t.specular&&(t.specular=[1,1,1,1]);for(var r in e)t[r]=e[r];var n=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,n),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.vertices),gl.STATIC_DRAW);var o=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,o),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Configuration.calculateNormals(t.vertices,t.indices)),gl.STATIC_DRAW);var a;t.scalars&&(a=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.scalars),gl.STATIC_DRAW),t.cbo=a);var s,l;t.texture_coords&&(console.info("the object "+t.name+" has texture coordinates"),s=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,s),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.texture_coords),gl.STATIC_DRAW),t.tbo=s,l=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,l),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Configuration.calculateTangents(t.vertices,t.texture_coords,t.indices)),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null),t.tanbo=l),t.image&&(t.texture=new Texture(t.image));var u=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,u),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices),gl.STATIC_DRAW),t.vbo=n,t.ibo=u,t.nbo=o,gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.bindBuffer(gl.ARRAY_BUFFER,null),Scene.objects.push(t),console.info(t.remote?t.alias+" has been added to the scene [Remote]":t.alias+" has been added to the scene [Local]"),void 0!=i&&i(t),console.log(this.objects)},removeObject:function(t){var e=this.getObject(t),i=this.objects.indexOf(e);this.objects.splice(i,1)},renderFirst:function(t){var e=this.getObject(t),i=this.objects.indexOf(e);0!=i&&(this.objects.splice(i,1),this.objects.splice(0,0,e),console.info("render order:"+this.renderOrder()))},renderLast:function(t){var e=this.getObject(t),i=this.objects.indexOf(e);0!=i&&(this.objects.splice(i,1),this.objects.push(e),console.info("render order:"+this.renderOrder()))},renderSooner:function(t){var e=this.getObject(t),i=this.objects.indexOf(e);0!=i&&(this.objects.splice(i,1),this.objects.splice(i-1,0,e),console.info("render order:"+this.renderOrder()))},renderLater:function(t){var e=this.getObject(t),i=this.objects.indexOf(e);i!=this.objects.length-1&&(this.objects.splice(i,1),this.objects.splice(i+1,0,e),console.info("render order:"+this.renderOrder()))},renderOrder:function(){for(var t="[ ",e=0,i=this.objects.length;i>e;e++)t+=this.objects[e].alias+" ";return t+="]"}},Axis={alias:"axis",dim:10,vertices:[-10,0,0,10,0,0,0,-5,0,0,5,0,0,0,-10,0,0,10],indices:[0,1,2,3,4,5],colors:[1,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1],wireframe:!0,perVertexColor:!0,build:function(t){t&&(Axis.dim=t),Axis.vertices=[-t,0,0,t,0,0,0,-t/2,0,0,t/2,0,0,0,-t,0,0,t]}},Floor={alias:"floor",wireframe:!0,dim:50,lines:50,vertices:[],indices:[],diffuse:[.7,.7,.7,1],build:function(t,e){t&&(Floor.dim=t),e&&(Floor.lines=2*Floor.dim/e);for(var i=2*Floor.dim/Floor.lines,r=[],n=[],o=0;o<=Floor.lines;o++)r[6*o]=-Floor.dim,r[6*o+1]=0,r[6*o+2]=-Floor.dim+o*i,r[6*o+3]=Floor.dim,r[6*o+4]=0,r[6*o+5]=-Floor.dim+o*i,r[6*(Floor.lines+1)+6*o]=-Floor.dim+o*i,r[6*(Floor.lines+1)+6*o+1]=0,r[6*(Floor.lines+1)+6*o+2]=-Floor.dim,r[6*(Floor.lines+1)+6*o+3]=-Floor.dim+o*i,r[6*(Floor.lines+1)+6*o+4]=0,r[6*(Floor.lines+1)+6*o+5]=Floor.dim,n[2*o]=2*o,n[2*o+1]=2*o+1,n[2*(Floor.lines+1)+2*o]=2*(Floor.lines+1)+2*o,n[2*(Floor.lines+1)+2*o+1]=2*(Floor.lines+1)+2*o+1;Floor.vertices=r,Floor.indices=n}};Color.prototype.hex2rgb=function(t,e){var i=t.replace("#",""),r=parseInt(i.substring(0,2),16),n=parseInt(i.substring(2,4),16),o=parseInt(i.substring(4,6),16);return[r/255,n/255,o/255,e]},Color.prototype.rgb2hex=function(t){return"#"+("0"+parseInt(t[0],10).toString(16)).slice(-2)+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)},Color.prototype.setColorRgba=function(t,e,i,r){this.rgba=[t,e,i,r||1],this.hex=this.rgb2hex(this.rgba),this.vec=vec4(t,e,i,r)},Color.prototype.setColorHex=function(t,e){this.hex=t,this.rgba=this.hex2rgb(t,e||1),this.vec=vec4(this.rgba[0],this.rgba[1],this.rgba[2],this.rgba[3])},Color.prototype.getHex=function(){return this.hex},Color.prototype.getRgba=function(){return this.hex2rgb(this.hex,1)},Color.prototype.getVec=function(){return this.vec};var CAMERA_ORBITING_TYPE=1,CAMERA_TRACKING_TYPE=2;Camera.prototype.isMain=function(){return this.main},Camera.prototype.setType=function(t){this.type=t,t!=CAMERA_ORBITING_TYPE&&t!=CAMERA_TRACKING_TYPE&&(alert("Wrong Camera Type!. Setting Orbitting type by default"),this.type=CAMERA_ORBITING_TYPE)},Camera.prototype.goHome=function(t){null!=t&&(this.home=t),this.setPosition(this.home),this.setAzimuth(0),this.setElevation(0),this.steps=0},Camera.prototype.dolly=function(t){var e=this,i=vec3.create(),r=vec3.create();i=e.position;var n=t-e.steps;vec3.normalize(e.normal,r);var o=vec3.create();e.type==CAMERA_TRACKING_TYPE?(o[0]=i[0]-n*r[0],o[1]=i[1]-n*r[1],o[2]=i[2]-n*r[2]):(o[0]=i[0],o[1]=i[1],o[2]=i[2]-n),e.setPosition(o),e.steps=t},Camera.prototype.setPosition=function(t){vec3.set(t,this.position),this.update()},Camera.prototype.setFocus=function(t){vec3.set(t,this.focus),this.update()},Camera.prototype.setAzimuth=function(t){this.changeAzimuth(t-this.azimuth)},Camera.prototype.changeAzimuth=function(t){var e=this;e.azimuth+=t,(e.azimuth>360||e.azimuth<-360)&&(e.azimuth=e.azimuth%360),e.update()},Camera.prototype.setElevation=function(t){this.changeElevation(t-this.elevation)},Camera.prototype.changeElevation=function(t){var e=this;e.elevation+=t,(e.elevation>360||e.elevation<-360)&&(e.elevation=e.elevation%360),e.update()},Camera.prototype.calculateOrientation=function(){var t=this.matrix;mat4.multiplyVec4(t,[1,0,0,0],this.right),mat4.multiplyVec4(t,[0,1,0,0],this.up),mat4.multiplyVec4(t,[0,0,1,0],this.normal)},Camera.prototype.update=function(){if(mat4.identity(this.matrix),this.calculateOrientation(),this.type==CAMERA_TRACKING_TYPE)mat4.translate(this.matrix,this.position),mat4.rotateY(this.matrix,this.azimuth*Math.PI/180),mat4.rotateX(this.matrix,this.elevation*Math.PI/180);
else{{mat4.create()}mat4.rotateY(this.matrix,this.azimuth*Math.PI/180),mat4.rotateX(this.matrix,this.elevation*Math.PI/180),mat4.translate(this.matrix,this.position)}this.calculateOrientation(),this.type==CAMERA_TRACKING_TYPE&&mat4.multiplyVec4(this.matrix,[0,0,0,1],this.position)},Camera.prototype.getViewTransform=function(){var t=mat4.create();return mat4.inverse(this.matrix,t),t},Camera.prototype.draw=function(){this.goHome(this.tHome),this.setFocus(this.tFocus),this.setAzimuth(this.tAzimuth),this.setElevation(this.tElevation)};var Cameras={list:[],add:function(t){return t instanceof Camera?void this.list.push(t):void alert("the parameter is not a light")},getArray:function(t){for(var e=[],i=0,r=this.list.length;r>i;i+=1)e=e.concat(this.list[i][t]);return e},get:function(t){if("number"==typeof t&&t>=0&&t<this.list.length)return this.list[t];if("string"==typeof t){for(var e=0,i=this.list.length;i>e;e+=1)if(this.list[e].alias==t)return this.list[e];throw"Camera "+t+" does not exist"}throw"Unknown parameter"},getNumCameras:function(){return this.list.length<=0?1:this.list.length}};CameraInteractor.prototype.setPicker=function(t){this.picker=t},CameraInteractor.prototype.get2DCoords=function(t){for(var e,i,r=0,n=0,o=this.canvas;o&&"BODY"!=o.tagName;)r+=o.offsetTop,n+=o.offsetLeft,o=o.offsetParent;return n+=window.pageXOffset,r+=window.pageYOffset,e=t.clientX-n,i=c_height-(t.clientY-r),{x:e,y:i}},CameraInteractor.prototype.onMouseUp=function(t){this.dragging=!1,t.shiftKey||(this.picking=!1,this.picker&&this.picker.stop())},CameraInteractor.prototype.onMouseDown=function(t){if(this.dragging=!0,this.x=t.clientX,this.y=t.clientY,this.button=t.button,this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100,null!=this.picker){var e=this.get2DCoords(t);if(this.picking=this.picker.find(e),this.picking){var i=this.picker.plist.length,r=1==i?i+" object has been selected":i+" objects have been selected";$("#title-id").html(r)}else this.picker.stop(),$("#title-id").html("Please select an object and drag it. (Alt key drags on the camera axis)")}},CameraInteractor.prototype.onMouseMove=function(t){if(this.lastX=this.x,this.lastY=this.y,this.x=t.clientX,this.y=t.clientY,this.dragging){this.ctrl=t.ctrlKey,this.alt=t.altKey;var e=this.x-this.lastX,i=this.y-this.lastY;return this.picking&&this.picker.moveCallback?void this.picker.moveCallback(this,e,i):void(0==this.button&&(this.alt?this.dolly(i):this.rotate(e,i)))}},CameraInteractor.prototype.onKeyDown=function(t){var e=this.camera;this.key=t.keyCode,this.ctrl=t.ctrlKey,this.ctrl||(38==this.key?e.changeElevation(10):40==this.key?e.changeElevation(-10):37==this.key?e.changeAzimuth(-10):39==this.key?e.changeAzimuth(10):87==this.key?(fovy&&(fovy+=5),console.info("FovY:"+fovy)):78==this.key&&(fovy&&(fovy-=5),console.info("FovY:"+fovy)))},CameraInteractor.prototype.onKeyUp=function(t){17==t.keyCode&&(this.ctrl=!1)},CameraInteractor.prototype.update=function(){var t=this,e=this.canvas;e.onmousedown=function(e){t.onMouseDown(e)},e.onmouseup=function(e){t.onMouseUp(e)},e.onmousemove=function(e){t.onMouseMove(e)},window.onkeydown=function(e){t.onKeyDown(e)},window.onkeyup=function(e){t.onKeyUp(e)}},CameraInteractor.prototype.dolly=function(t){t>0?this.dloc+=this.dstep:this.dloc-=this.dstep,this.camera.dolly(this.dloc)},CameraInteractor.prototype.rotate=function(t,e){var i=this.camera,r=this.canvas,n=-20/r.height,o=-20/r.width,a=t*o*this.MOTION_FACTOR,s=e*n*this.MOTION_FACTOR;i.changeAzimuth(a),i.changeElevation(s)},SceneTransforms.prototype.calculateModelView=function(){this.mvMatrix=this.camera.getViewTransform()},SceneTransforms.prototype.calculateNormal=function(){mat4.identity(this.nMatrix),mat4.set(this.mvMatrix,this.nMatrix),mat4.inverse(this.nMatrix),mat4.transpose(this.nMatrix)},SceneTransforms.prototype.calculatePerspective=function(){mat4.identity(this.pMatrix),mat4.perspective(30,c_width/c_height,.1,1e3,this.pMatrix)},SceneTransforms.prototype.init=function(){this.calculateModelView(),this.calculatePerspective(),this.calculateNormal()},SceneTransforms.prototype.updatePerspective=function(){mat4.perspective(30,c_width/c_height,.1,1e3,this.pMatrix)},SceneTransforms.prototype.setMatrixUniforms=function(){this.calculateNormal(),gl.uniformMatrix4fv(Program.uMVMatrix,!1,this.mvMatrix),gl.uniformMatrix4fv(Program.uPMatrix,!1,this.pMatrix),gl.uniformMatrix4fv(Program.uNMatrix,!1,this.nMatrix)},SceneTransforms.prototype.push=function(){var t=mat4.create();mat4.set(this.mvMatrix,t),this.stack.push(t)},SceneTransforms.prototype.pop=function(){0!=this.stack.length&&(this.mvMatrix=this.stack.pop())},NodeTree.prototype.getFather=function(){return this.father},NodeTree.prototype.setFather=function(t){t instanceof NodeTree?this.father=t:console.log("This is not a node")},NodeTree.prototype.getEntity=function(){return this.entity},NodeTree.prototype.setEntity=function(t){t instanceof Entity?this.entity=t:console.log("This is not an entity")},NodeTree.prototype.index=function(){return this.isRoot()?void 0:this.father.children.indexOf(this)},NodeTree.prototype.isRoot=function(){return""==this.father},NodeTree.prototype.childrenNumber=function(){return this.children.length},NodeTree.prototype.nextSibling=function(){return!this.isRoot()&&this.hasSibling()?this.father.getChild(this.index()+1):null},NodeTree.prototype.hasSibling=function(){return this.father.existsChild(this.father.getChild(this.index()+1))},NodeTree.prototype.addChild=function(t){t.setFather(this),this.children.push(t)},NodeTree.prototype.newChild=function(){return this.addChild(new NodeTree("",this,[]))},NodeTree.prototype.getChild=function(t){return this.existsChild(this.children[t])?this.children[t]:null},NodeTree.prototype.firstChild=function(){return this.getChild(0)},NodeTree.prototype.lastChild=function(){return this.getChild(this.childrenNumber()-1)},NodeTree.prototype.removeChild=function(t){this.existsChild(t)?this.children.splice(this.index(),1):!1},NodeTree.prototype.removeChildren=function(){this.children=[]},NodeTree.prototype["delete"]=function(){this.father.removeChild(this)},NodeTree.prototype.existsChild=function(t){return-1!=this.children.indexOf(t)},NodeTree.prototype.draw=function(){this.entity?(console.log(this.entity),this.entity.draw()):console.log("There is no entity for this node")},Tree.prototype.getRoot=function(){return this.root},Tree.prototype.preorder=function(t,e){null!=t&&(console.log(e),t.getEntity()instanceof Mesh&&t.getEntity().draw(e),this.preorder(t.firstChild(),e),this.preorder(t.nextSibling(),e))},Tree.prototype.save=function(t,e){null!=t&&(t.getEntity()instanceof Light?Lights.add(t.getEntity()):t.getEntity()instanceof Camera?Cameras.add(t.getEntity()):t.getEntity()instanceof Mesh&&Scene.loadObject(t.getEntity().getFilename(),t.getEntity().getAlias(),t.getEntity().getAttributes()),this.save(t.firstChild(),e),this.save(t.nextSibling(),e))},Tree.prototype.draw=function(t){this.preorder(this.getRoot().firstChild(),t)},Tree.prototype.saveEntities=function(){this.save(this.getRoot().firstChild())};var WEBGLAPP_RENDER=void 0,WEBGLAPP_TIMER_ID=-1,WEBGLAPP_RENDER_RATE=16;Aubengine.prototype.getTree=function(){return this.tree},Aubengine.prototype.getRoot=function(){return this.tree.getRoot()},Aubengine.prototype.setUpEnvironment=function(){gl.clearColor(56/255,161/255,172/255,1),gl.clearDepth(1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)},Aubengine.prototype.createCamera=function(t,e,i,r,n){var o=new Camera(t,CAMERA_ORBITING_TYPE,e,i,r,n);return o},Aubengine.prototype.setMainCamera=function(t){t.draw(),this.interactor=new CameraInteractor(t,this.canvas),this.transforms=new SceneTransforms(t),this.transforms.init(),interactor=this.interactor},Aubengine.prototype.loadProgram=function(t){Program.load(),gl.uniform3fv(Program.uLightPosition,Lights.getArray("position")),gl.uniform3fv(Program.uLa,Lights.getArray("ambient")),gl.uniform3fv(Program.uLd,Lights.getArray("diffuse")),gl.uniform3fv(Program.uLs,Lights.getArray("specular")),gl.uniform3fv(Program.uKa,[1,1,1]),gl.uniform3fv(Program.uKd,[1,1,1]),gl.uniform3fv(Program.uKs,[1,1,1]),gl.uniform1f(Program.uNs,1),gl.uniform1i(Program.uTranslateLights,t||!1)},Aubengine.prototype.createMesh=function(t,e){var i=new Mesh(t,e);return i},Aubengine.prototype.addFloor=function(t){Floor.build(80,2),Floor.Ka=[1,1,1],Floor.Kd=[.6,.6,.6],Floor.Ks=[1,1,1],Floor.Ni=1,Floor.Ns=1,Floor.d=1,Floor.illum=1,Floor.visible=t},Aubengine.prototype.createLight=function(t,e,i,r,n){if(null==t||null==e||null==i||null==r||null==n)alert("Light can not be created! Wrong parameters.");else{var o=new Light(t);o.setPosition(e),o.setDiffuse(i),o.setAmbient(r),o.setSpecular(n)}return o},Aubengine.prototype.addNode=function(t,e){t.addChild(e)},Aubengine.prototype.createNode=function(t){var e=new NodeTree(t);return e},Aubengine.prototype.draw=function(){this.loadProgram(!1),gl.viewport(0,0,c_width,c_height),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.transforms.updatePerspective(),this.tree.draw(this.transforms)},Aubengine.prototype.start=function(){WEBGLAPP_RENDER=this.draw,renderLoop()},Aubengine.prototype.refresh=function(){WEBGLAPP_RENDER&&WEBGLAPP_RENDER(!1)},renderLoop=function(){WEBGLAPP_TIMER_ID=setInterval(WEBGLAPP_RENDER,WEBGLAPP_RENDER_RATE)},window.onblur=function(){clearInterval(WEBGLAPP_TIMER_ID),console.info("Rendering stopped")},window.onfocus=function(){renderLoop(),console.info("Rendering resumed")};